#pragma once
#include "../utils/option/Option.hpp"
#include "../utils/str_slice/StrSlice.cpp"
#include "Listener.hpp"
#include "Networking.hpp"
#include <sys/poll.h>
#include <sys/socket.h>

#ifndef REQUEST_BODY_MAX
#define REQUEST_BODY_MAX = 1000000
#endif

// idea behind this only way to construct this class is by the funcioon accept
// that will be called by listener
// this class will allocate on initialization, will never allocate during
class Stream : Networking {
public:
  Stream(const Stream &other);
  ~Stream();
  Option<std::string> read(void);
  Stream &operator=(const Stream &other);
  static Result<Option<Stream>> accept(Listener &lis);
  int getFd(void) const;

private:
  char *request;
  StrSlice header;
  StrSlice body;
  Stream(struct pollfd &fd);
  Stream();
  Stream(int fd);
  struct pollfd &pl;
};
